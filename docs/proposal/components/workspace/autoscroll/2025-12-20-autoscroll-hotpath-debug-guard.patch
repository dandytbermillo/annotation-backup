--- components/canvas/canvas-panel.tsx	2025-12-21 17:28:00
+++ /tmp/canvas-panel.tsx	2025-12-21 19:42:34
@@ -30,7 +30,7 @@
 import { Save, Pencil, Wrench } from "lucide-react"
 import { TypeSelector, type AnnotationType } from "./type-selector"
 import { BranchesSection } from "./branches-section"
-import { debugLog } from "@/lib/utils/debug-logger"
+import { debugLog, isDebugEnabled } from "@/lib/utils/debug-logger"
 import { useCanvasWorkspace, SHARED_WORKSPACE_ID } from "./canvas-workspace-context"
 import { ensurePanelKey } from "@/lib/canvas/composite-id"
 import { HOVER_HIGHLIGHT_DURATION_MS } from "@/lib/constants/ui-timings"
@@ -809,50 +809,55 @@
   
   // Auto-scroll functionality for panel dragging
   const handleAutoScroll = useCallback((deltaX: number, deltaY: number) => {
+    const shouldLog = isDebugEnabled()
     if (!dragState.current.isDragging) {
+      if (shouldLog) {
+        debugLog({
+          component: 'CanvasPanel',
+          action: 'auto_scroll_ignored_not_dragging',
+          metadata: {
+            panelId,
+            scrollDelta: { x: deltaX, y: deltaY },
+            reason: 'isDragging is false'
+          }
+        })
+      }
+      return
+    }
+
+    if (shouldLog) {
+      // DEBUG: Log auto-scroll events with full state
+      const currentPanelLeft = panelRef.current ? panelRef.current.style.left : 'N/A'
+      const currentPanelTop = panelRef.current ? panelRef.current.style.top : 'N/A'
+
+      // Get canvas state before scroll
+      const canvasEl = document.getElementById('infinite-canvas')
+      const canvasTransformBefore = canvasEl ? window.getComputedStyle(canvasEl).transform : 'none'
+
       debugLog({
         component: 'CanvasPanel',
-        action: 'auto_scroll_ignored_not_dragging',
+        action: 'auto_scroll_EXECUTING',
         metadata: {
           panelId,
           scrollDelta: { x: deltaX, y: deltaY },
-          reason: 'isDragging is false'
+          currentPanelPosition: { left: currentPanelLeft, top: currentPanelTop },
+          cameraEnabled: isCameraEnabled,
+          moveCount: dragState.current.mouseMoveCount,
+          canvasTransformBefore,
+          canvasState: {
+            translateX: state.canvasState?.translateX || 0,
+            translateY: state.canvasState?.translateY || 0,
+            zoom: state.canvasState?.zoom || 1
+          },
+          dragState: {
+            initialPosition: { ...dragState.current.initialPosition },
+            pointerDelta: { ...dragState.current.pointerDelta },
+            autoScrollOffset: { ...dragState.current.autoScrollOffset }
+          },
+          scrollMethod: isCameraEnabled ? 'CAMERA_PAN' : 'LEGACY_PANEL_MOVE'
         }
       })
-      return
     }
-
-    // DEBUG: Log auto-scroll events with full state
-    const currentPanelLeft = panelRef.current ? panelRef.current.style.left : 'N/A'
-    const currentPanelTop = panelRef.current ? panelRef.current.style.top : 'N/A'
-
-    // Get canvas state before scroll
-    const canvasEl = document.getElementById('infinite-canvas')
-    const canvasTransformBefore = canvasEl ? window.getComputedStyle(canvasEl).transform : 'none'
-
-    debugLog({
-      component: 'CanvasPanel',
-      action: 'auto_scroll_EXECUTING',
-      metadata: {
-        panelId,
-        scrollDelta: { x: deltaX, y: deltaY },
-        currentPanelPosition: { left: currentPanelLeft, top: currentPanelTop },
-        cameraEnabled: isCameraEnabled,
-        moveCount: dragState.current.mouseMoveCount,
-        canvasTransformBefore,
-        canvasState: {
-          translateX: state.canvasState?.translateX || 0,
-          translateY: state.canvasState?.translateY || 0,
-          zoom: state.canvasState?.zoom || 1
-        },
-        dragState: {
-          initialPosition: { ...dragState.current.initialPosition },
-          pointerDelta: { ...dragState.current.pointerDelta },
-          autoScrollOffset: { ...dragState.current.autoScrollOffset }
-        },
-        scrollMethod: isCameraEnabled ? 'CAMERA_PAN' : 'LEGACY_PANEL_MOVE'
-      }
-    })
 
     if (isCameraEnabled) {
       // Use camera-based panning (pan opposite to pointer delta)
@@ -867,37 +872,39 @@
         const nextLeft = initialPosition.x + pointerDelta.x - autoScrollOffset.x
         const nextTop = initialPosition.y + pointerDelta.y - autoScrollOffset.y
 
-        // DEBUG: Comprehensive viewport + panel state logging
-        // Get canvas transform to detect viewport panning
-        const canvasEl = document.getElementById('infinite-canvas')
-        const canvasTransform = canvasEl ? window.getComputedStyle(canvasEl).transform : 'none'
+        if (shouldLog) {
+          // DEBUG: Comprehensive viewport + panel state logging
+          // Get canvas transform to detect viewport panning
+          const canvasEl = document.getElementById('infinite-canvas')
+          const canvasTransform = canvasEl ? window.getComputedStyle(canvasEl).transform : 'none'
 
-        // Get ALL panel positions to see if multiple panels move
-        const allPanels = document.querySelectorAll('[data-panel-id]')
-        const allPanelPositions: Record<string, { left: string; top: string }> = {}
-        allPanels.forEach(panel => {
-          const panelEl = panel as HTMLElement
-          const panelId = panelEl.getAttribute('data-panel-id')
-          if (panelId) {
-            allPanelPositions[panelId] = {
-              left: panelEl.style.left || '0',
-              top: panelEl.style.top || '0'
+          // Get ALL panel positions to see if multiple panels move
+          const allPanels = document.querySelectorAll('[data-panel-id]')
+          const allPanelPositions: Record<string, { left: string; top: string }> = {}
+          allPanels.forEach(panel => {
+            const panelEl = panel as HTMLElement
+            const panelId = panelEl.getAttribute('data-panel-id')
+            if (panelId) {
+              allPanelPositions[panelId] = {
+                left: panelEl.style.left || '0',
+                top: panelEl.style.top || '0'
+              }
             }
-          }
-        })
+          })
 
-        debugLog({
-          component: 'CanvasPanel',
-          action: 'auto_scroll_comprehensive_state',
-          metadata: {
-            draggedPanelId: panelId,
-            draggedPanelCalculated: { nextLeft, nextTop },
-            dragState: { initialPosition, pointerDelta, autoScrollOffset },
-            canvasTransform,
-            allPanelPositions,
-            viewportSize: { width: window.innerWidth, height: window.innerHeight }
-          }
-        })
+          debugLog({
+            component: 'CanvasPanel',
+            action: 'auto_scroll_comprehensive_state',
+            metadata: {
+              draggedPanelId: panelId,
+              draggedPanelCalculated: { nextLeft, nextTop },
+              dragState: { initialPosition, pointerDelta, autoScrollOffset },
+              canvasTransform,
+              allPanelPositions,
+              viewportSize: { width: window.innerWidth, height: window.innerHeight }
+            }
+          })
+        }
 
         panelRef.current.style.left = `${nextLeft}px`
         panelRef.current.style.top = `${nextTop}px`
@@ -906,19 +913,21 @@
       }
     } else {
       // Legacy: Move ALL panels to simulate canvas panning
-      debugLog({
-        component: 'CanvasPanel',
-        action: 'auto_scroll_legacy_mode',
-        metadata: {
-          panelId,
-          scrollDelta: { x: deltaX, y: deltaY },
-          note: 'This mode moves ALL panels - if this logs, camera is disabled'
-        }
-      })
+      if (shouldLog) {
+        debugLog({
+          component: 'CanvasPanel',
+          action: 'auto_scroll_legacy_mode',
+          metadata: {
+            panelId,
+            scrollDelta: { x: deltaX, y: deltaY },
+            note: 'This mode moves ALL panels - if this logs, camera is disabled'
+          }
+        })
+      }
 
       const allPanels = document.querySelectorAll('[data-panel-id]')
-      const panelPositionsBefore: Record<string, { left: number; top: number }> = {}
-      const panelPositionsAfter: Record<string, { left: number; top: number }> = {}
+      const panelPositionsBefore: Record<string, { left: number; top: number }> | null = shouldLog ? {} : null
+      const panelPositionsAfter: Record<string, { left: number; top: number }> | null = shouldLog ? {} : null
 
       allPanels.forEach(panel => {
         const panelEl = panel as HTMLElement
@@ -926,7 +935,9 @@
         if (pid) {
           const currentLeft = parseInt(panelEl.style.left || '0', 10)
           const currentTop = parseInt(panelEl.style.top || '0', 10)
-          panelPositionsBefore[pid] = { left: currentLeft, top: currentTop }
+          if (panelPositionsBefore) {
+            panelPositionsBefore[pid] = { left: currentLeft, top: currentTop }
+          }
 
           if (panelEl.id === `panel-${panelId}` && dragState.current.isDragging) {
             // For the dragging panel, update its initial position
@@ -940,20 +951,24 @@
 
           const newLeft = parseInt(panelEl.style.left || '0', 10)
           const newTop = parseInt(panelEl.style.top || '0', 10)
-          panelPositionsAfter[pid] = { left: newLeft, top: newTop }
+          if (panelPositionsAfter) {
+            panelPositionsAfter[pid] = { left: newLeft, top: newTop }
+          }
         }
       })
 
-      debugLog({
-        component: 'CanvasPanel',
-        action: 'auto_scroll_legacy_panel_moves',
-        metadata: {
-          panelId,
-          panelPositionsBefore,
-          panelPositionsAfter,
-          scrollDelta: { x: deltaX, y: deltaY }
-        }
-      })
+      if (shouldLog) {
+        debugLog({
+          component: 'CanvasPanel',
+          action: 'auto_scroll_legacy_panel_moves',
+          metadata: {
+            panelId,
+            panelPositionsBefore,
+            panelPositionsAfter,
+            scrollDelta: { x: deltaX, y: deltaY }
+          }
+        })
+      }
     }
   }, [panelId, isCameraEnabled, panCameraBy])
   
@@ -2496,7 +2511,7 @@
       const positionDeltaMagnitude = Math.sqrt(positionDeltaX * positionDeltaX + positionDeltaY * positionDeltaY)
 
       // DEBUG: Log jitter metrics for moves 5-20
-      if (state.mouseMoveCount >= 5 && state.mouseMoveCount <= 20) {
+      if (state.mouseMoveCount >= 5 && state.mouseMoveCount <= 20 && isDebugEnabled()) {
         debugLog({
           component: 'CanvasPanel',
           action: 'drag_jitter_raf_no_react',
@@ -2555,34 +2570,36 @@
       const nearAnyEdge = nearLeftEdge || nearRightEdge || nearTopEdge || nearBottomEdge
 
       // DEBUG: Log mouse movement and edge proximity
-      debugLog({
-        component: 'CanvasPanel',
-        action: 'drag_mouse_move',
-        metadata: {
-          panelId,
-          moveCount: state.mouseMoveCount,
-          cursorPosition: { x: e.clientX, y: e.clientY },
-          distanceToEdges: {
-            left: distanceToLeft,
-            right: distanceToRight,
-            top: distanceToTop,
-            bottom: distanceToBottom
-          },
-          nearEdge: {
-            left: nearLeftEdge,
-            right: nearRightEdge,
-            top: nearTopEdge,
-            bottom: nearBottomEdge,
-            any: nearAnyEdge
-          },
-          threshold,
-          aboutToCheckAutoScroll: true,
-          dragState: {
-            pointerDelta: { ...state.pointerDelta },
-            autoScrollOffset: { ...state.autoScrollOffset }
+      if (isDebugEnabled()) {
+        debugLog({
+          component: 'CanvasPanel',
+          action: 'drag_mouse_move',
+          metadata: {
+            panelId,
+            moveCount: state.mouseMoveCount,
+            cursorPosition: { x: e.clientX, y: e.clientY },
+            distanceToEdges: {
+              left: distanceToLeft,
+              right: distanceToRight,
+              top: distanceToTop,
+              bottom: distanceToBottom
+            },
+            nearEdge: {
+              left: nearLeftEdge,
+              right: nearRightEdge,
+              top: nearTopEdge,
+              bottom: nearBottomEdge,
+              any: nearAnyEdge
+            },
+            threshold,
+            aboutToCheckAutoScroll: true,
+            dragState: {
+              pointerDelta: { ...state.pointerDelta },
+              autoScrollOffset: { ...state.autoScrollOffset }
+            }
           }
-        }
-      })
+        })
+      }
 
       // Check for auto-scroll when near edges
       checkAutoScrollRef.current(e.clientX, e.clientY)
