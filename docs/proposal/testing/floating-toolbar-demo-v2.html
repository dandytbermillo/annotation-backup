<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Floating Toolbar Demo ‚Äì Minimal + On-Demand Panels</title>
  <style>
    :root {
      color-scheme: light dark;
      --toolbar-bg: rgba(24, 24, 28, 0.92);
      --toolbar-border: rgba(255, 255, 255, 0.08);
      --panel-bg: rgba(34, 34, 40, 0.98);
      --text-primary: #f8f9fb;
      --text-muted: rgba(248, 249, 251, 0.6);
      --accent: #55a3ff;
      --chip-bg: rgba(85, 163, 255, 0.15);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at 20% 20%, rgba(85, 163, 255, 0.12), transparent 60%),
                  radial-gradient(circle at 80% 30%, rgba(255, 200, 120, 0.12), transparent 55%),
                  linear-gradient(145deg, #111219, #0b0c11);
      color: var(--text-primary);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }

    main {
      width: min(1100px, 90vw);
      height: min(720px, 80vh);
      border-radius: 28px;
      position: relative;
      background: rgba(10, 12, 18, 0.55);
      box-shadow: 0 40px 120px rgba(0, 0, 0, 0.65), inset 0 1px 0 rgba(255, 255, 255, 0.05);
      overflow: hidden;
    }

    .canvas-hint {
      position: absolute;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.55);
      padding: 12px 24px;
      border-radius: 999px;
      font-size: 14px;
      letter-spacing: 0.02em;
      color: var(--text-muted);
      backdrop-filter: blur(10px);
    }

    /* Toolbar */
    .floating-toolbar {
      position: absolute;
      left: -9999px;
      top: -9999px;
      display: none;
      flex-direction: column;
      gap: 0;
      z-index: 2000;
    }

    .floating-toolbar.visible {
      display: flex;
    }

    .toolbar-shell {
      display: flex;
      flex-direction: column;
      border-radius: 999px;
      background: var(--toolbar-bg);
      border: 1px solid var(--toolbar-border);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
      transition: transform 160ms ease, box-shadow 160ms ease, border-radius 200ms ease;
      overflow: hidden;
    }


    .toolbar-shell:hover {
      transform: translateY(-2px);
      box-shadow: 0 22px 60px rgba(0, 0, 0, 0.5);
    }

    .toolbar-main-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
    }

    .toolbar-handle {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.06);
      display: grid;
      place-items: center;
      color: var(--text-muted);
      font-size: 18px;
      cursor: grab;
      user-select: none;
    }

    .toolbar-button {
      border: none;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 14px;
      color: var(--text-primary);
      background: rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: background 140ms ease, transform 140ms ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .toolbar-button:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-1px);
    }

    .toolbar-button.active {
      background: rgba(85, 163, 255, 0.25);
      color: var(--accent);
    }

    .toolbar-button.primary {
      background: linear-gradient(135deg, #5ca9ff, #3f7fff);
      color: #0b1020;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(85, 163, 255, 0.32);
    }

    /* Tools category panel (floating outside toolbar) */
    .tools-category-panel {
      position: fixed;
      background: var(--panel-bg);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 30px 90px rgba(0, 0, 0, 0.45);
      padding: 14px;
      display: none;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      z-index: 1999;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 120ms ease, transform 160ms ease;
      max-width: 480px;
    }

    .tools-category-panel.visible {
      display: flex;
      opacity: 1;
      transform: translateY(0);
    }

    .tool-category-button {
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.07);
      color: var(--text-primary);
      padding: 11px 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: background 140ms ease, transform 140ms ease, box-shadow 140ms ease;
      white-space: nowrap;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .tool-category-button:hover {
      background: rgba(85, 163, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(85, 163, 255, 0.15);
      border-color: rgba(85, 163, 255, 0.3);
    }

    .recent-chip {
      position: fixed;
      background: var(--chip-bg);
      color: var(--accent);
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 12px;
      white-space: nowrap;
      box-shadow: 0 8px 20px rgba(85, 163, 255, 0.2);
      pointer-events: none;
      border: 1px solid rgba(85, 163, 255, 0.3);
      opacity: 0;
      transition: opacity 200ms ease;
    }

    .recent-chip.visible {
      opacity: 1;
    }

    /* Expandable panels */
    .toolbar-panels {
      position: relative;
    }

    .panel {
      position: fixed;
      width: 280px;
      background: var(--panel-bg);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 30px 90px rgba(0, 0, 0, 0.45);
      overflow: hidden;
      opacity: 0;
      pointer-events: none;
      transform: translateY(10px);
      transition: opacity 120ms ease, transform 160ms ease;
      z-index: 1999;
    }

    .panel.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      font-size: 14px;
      letter-spacing: 0.02em;
    }

    .panel-header button {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 14px;
      cursor: pointer;
    }

    .panel-list {
      max-height: 280px;
      overflow-y: auto;
      padding: 8px 4px 8px 16px;
      display: grid;
      gap: 10px;
    }

    .panel-item {
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.06);
      transition: background 120ms ease, border 120ms ease;
      cursor: pointer;
    }

    .panel-item:hover {
      background: rgba(85, 163, 255, 0.12);
      border-color: rgba(85, 163, 255, 0.35);
    }

    .panel-item .title {
      font-size: 13px;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .panel-subheading {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      padding: 10px 12px 4px;
    }

    .panel-grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 8px;
      padding: 0 12px 12px;
    }

    .format-chip {
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.07);
      color: var(--text-primary);
      padding: 8px 0;
      font-size: 13px;
      cursor: pointer;
      transition: background 120ms ease, transform 120ms ease;
    }

    .format-chip:hover {
      background: rgba(85, 163, 255, 0.22);
      transform: translateY(-1px);
    }

    .format-chip.danger {
      color: #ff8a8a;
    }

    .panel-item .meta {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
    }

    .tree-level {
      border-left: 1px solid rgba(255, 255, 255, 0.08);
      margin-left: 10px;
      padding-left: 12px;
      display: grid;
      gap: 8px;
    }
  </style>
</head>
<body>
  <main>
    <div class="canvas-hint">‚å• Right-click to imagine dropping a note. Toolbar adapts per surface.</div>

    <div class="floating-toolbar" id="toolbar">
      <div class="toolbar-shell" id="toolbarShell">
        <div class="toolbar-main-row">
          <div class="toolbar-handle" title="Drag to reposition">‚ãÆ</div>
          <button class="toolbar-button primary" id="add-note">+ Note</button>
          <div class="toolbar-panels">
            <button class="toolbar-button" data-panel="recents">Recents ‚ñæ</button>
            <button class="toolbar-button" data-panel="org">Org ‚ñæ</button>
            <button class="toolbar-button" id="tools-toggle">Tools ‚ñæ</button>
          </div>
        </div>
      </div>

      <!-- Tools category panel (floating outside toolbar) -->
      <div class="tools-category-panel" id="toolsCategoryPanel">
        <button class="tool-category-button" data-tool="layer">Layer</button>
        <button class="tool-category-button" data-tool="format">Format</button>
        <button class="tool-category-button" data-tool="resize">Resize</button>
        <button class="tool-category-button" data-tool="branches">Branches</button>
        <button class="tool-category-button" data-tool="actions">Actions</button>
      </div>

      <!-- Tool content panels -->
      <!-- Layer panel (from canvas-panel.tsx header buttons: Bring to Front, Send to Back) -->
      <section class="panel" id="panel-layer" aria-label="Layer controls">
        <header class="panel-header">
          <span>Layer</span>
          <button data-close>&times;</button>
        </header>
        <div class="panel-list">
          <article class="panel-item">
            <div class="title">Bring to Front</div>
            <div class="meta"><span>Move panel to top</span></div>
          </article>
          <article class="panel-item">
            <div class="title">Send to Back</div>
            <div class="meta"><span>Move panel to bottom</span></div>
          </article>
        </div>
      </section>

      <!-- Format panel (from format-toolbar.tsx) -->
      <section class="panel" id="panel-format" aria-label="Format options">
        <header class="panel-header">
          <span>Format</span>
          <button data-close>&times;</button>
        </header>
        <div class="panel-list">
          <div class="panel-grid">
            <button class="format-chip" title="Bold"><strong>B</strong></button>
            <button class="format-chip" title="Italic"><em>I</em></button>
            <button class="format-chip" title="Underline"><u>U</u></button>
            <button class="format-chip" title="Strikethrough"><s>S</s></button>
            <button class="format-chip" title="Code">{ }</button>
            <button class="format-chip" title="Heading 1">H1</button>
            <button class="format-chip" title="Heading 2">H2</button>
            <button class="format-chip" title="Heading 3">H3</button>
            <button class="format-chip" title="Bullet List">‚Ä¢ ‚Ä¢</button>
            <button class="format-chip" title="Ordered List">1 2</button>
            <button class="format-chip" title="Blockquote">" "</button>
            <button class="format-chip" title="Code Block">&lt;/&gt;</button>
            <button class="format-chip" title="Horizontal Rule">‚Äî</button>
            <button class="format-chip" title="Highlight">‚òÖ</button>
            <button class="format-chip danger" title="Clear Format">‚úï</button>
          </div>
        </div>
      </section>

      <!-- Resize panel (from canvas-panel.tsx Resize button) -->
      <section class="panel" id="panel-resize" aria-label="Resize options">
        <header class="panel-header">
          <span>Resize</span>
          <button data-close>&times;</button>
        </header>
        <div class="panel-list">
          <article class="panel-item">
            <div class="title">Resize / Restore</div>
            <div class="meta"><span>Toggle panel height</span></div>
          </article>
        </div>
      </section>

      <!-- Branches panel (from canvas-panel.tsx Branches button with sidebar) -->
      <section class="panel" id="panel-branches" aria-label="Branch options">
        <header class="panel-header">
          <span>Branches</span>
          <button data-close>&times;</button>
        </header>
        <div class="panel-list">
          <div class="panel-subheading">Main Branch</div>
          <article class="panel-item">
            <div class="title">üìÑ Main Document</div>
            <div class="meta"><span>Root branch</span></div>
          </article>

          <div class="panel-subheading">Note Branches</div>
          <article class="panel-item">
            <div class="title">üìù Introduction</div>
            <div class="meta"><span>Note branch</span></div>
          </article>
          <article class="panel-item">
            <div class="title">üìù Key Points</div>
            <div class="meta"><span>Note branch</span></div>
          </article>

          <div class="panel-subheading">Explore Branches</div>
          <article class="panel-item">
            <div class="title">üîç Research Area</div>
            <div class="meta"><span>Explore branch</span></div>
          </article>

          <div class="panel-subheading">Promote Branches</div>
          <article class="panel-item">
            <div class="title">‚≠ê Final Version</div>
            <div class="meta"><span>Promote branch</span></div>
          </article>
        </div>
      </section>

      <!-- Actions panel (from annotation-toolbar.tsx: Note, Explore, Promote) -->
      <section class="panel" id="panel-actions" aria-label="Actions">
        <header class="panel-header">
          <span>Actions</span>
          <button data-close>&times;</button>
        </header>
        <div class="panel-list">
          <div class="panel-subheading">Create Annotation</div>
          <article class="panel-item">
            <div class="title">üìù Note</div>
            <div class="meta"><span>Create note branch</span></div>
          </article>
          <article class="panel-item">
            <div class="title">üîç Explore</div>
            <div class="meta"><span>Create explore branch</span></div>
          </article>
          <article class="panel-item">
            <div class="title">‚≠ê Promote</div>
            <div class="meta"><span>Create promote branch</span></div>
          </article>
        </div>
      </section>

      <!-- Floating panels (outside toolbar) -->
      <section class="panel" id="panel-recents" aria-label="Recent notes">
            <header class="panel-header">
              <span>Recent notes</span>
              <button data-close>&times;</button>
            </header>
            <div class="panel-list">
              <article class="panel-item">
                <div class="title">Design Sync ‚Äì action items</div>
                <div class="meta"><span>Edited 2m ago</span><span>04:12 clip</span></div>
              </article>
              <article class="panel-item">
                <div class="title">Research Synthesis</div>
                <div class="meta"><span>Edited 18m ago</span><span>15 cards</span></div>
              </article>
              <article class="panel-item">
                <div class="title">Customer Feedback ‚Äì Q2</div>
                <div class="meta"><span>Updated 1h ago</span><span>Branch: CS</span></div>
              </article>
              <article class="panel-item">
                <div class="title">üß™ Experiment ideas</div>
                <div class="meta"><span>Updated 3h ago</span><span>Draft</span></div>
              </article>
            </div>
          </section>

          <section class="panel" id="panel-org" aria-label="Organization tree">
            <header class="panel-header">
              <span>Organization</span>
              <button data-close>&times;</button>
            </header>
            <div class="panel-list">
              <article class="panel-item">
                <div class="title">üåø Growth Initiatives</div>
                <div class="meta"><span>6 branches</span><span>Last week</span></div>
              </article>
              <div class="tree-level">
                <article class="panel-item">
                  <div class="title">Launch Prep / L5</div>
                  <div class="meta"><span>3 notes</span><span>Today</span></div>
                </article>
                <article class="panel-item">
                  <div class="title">Messaging Experiments</div>
                  <div class="meta"><span>5 notes</span><span>Yesterday</span></div>
                </article>
              </div>
              <article class="panel-item">
                <div class="title">üì¶ Platform Stabilization</div>
                <div class="meta"><span>4 branches</span><span>2 days ago</span></div>
              </article>
              <article class="panel-item">
                <div class="title">üß≠ Discovery</div>
                <div class="meta"><span>2 branches</span><span>Active</span></div>
              </article>
            </div>
          </section>
          <section class="panel" id="panel-tools" aria-label="Tools menu">
            <header class="panel-header">
              <span>Tools</span>
              <button data-close>&times;</button>
            </header>
            <div class="panel-list">
              <article class="panel-item">
                <div class="title">Bring to front</div>
                <div class="meta"><span>Layer control</span><span>‚åò ‚Üë</span></div>
              </article>
              <article class="panel-item">
                <div class="title">Send to back</div>
                <div class="meta"><span>Layer control</span><span>‚åò ‚Üì</span></div>
              </article>
              <article class="panel-item">
                <div class="title">Resize panel</div>
                <div class="meta"><span>Adjust width / snap</span><span>‚áß R</span></div>
              </article>
              <div class="panel-subheading">Format</div>
              <div class="panel-grid">
                <button class="format-chip" title="Bold">B</button>
                <button class="format-chip" title="Italic" style="font-style: italic;">I</button>
                <button class="format-chip" title="Underline" style="text-decoration: underline;">U</button>
                <button class="format-chip" title="Heading 2">H2</button>
                <button class="format-chip" title="Heading 3">H3</button>
                <button class="format-chip" title="Bullet List">‚Ä¢ ‚Ä¢ ‚Ä¢</button>
                <button class="format-chip" title="Ordered List">1¬∑2¬∑3</button>
                <button class="format-chip" title="Quote">‚Äú‚Äù</button>
                <button class="format-chip" title="Highlight">‚òÖ</button>
                <button class="format-chip danger" title="Clear formatting">‚úï</button>
              </div>
              <div class="panel-subheading">Branches</div>
              <article class="panel-item">
                <div class="title">Duplicate branch</div>
                <div class="meta"><span>Clone structure</span><span>‚åò D</span></div>
              </article>
              <article class="panel-item">
                <div class="title">Move to‚Ä¶</div>
                <div class="meta"><span>Select destination folder</span><span>‚áß M</span></div>
              </article>
              <div class="panel-subheading">Actions</div>
              <article class="panel-item">
                <div class="title">Copy link</div>
                <div class="meta"><span>Share branch URL</span><span>‚åò L</span></div>
              </article>
              <article class="panel-item">
                <div class="title">Session summary</div>
                <div class="meta"><span>Generate quick recap</span><span>Beta</span></div>
              </article>
            </div>
          </section>

      <div class="recent-chip" id="recent-chip">Last: Design Sync</div>
    </div>
  </main>

      <script>
    const toolbar = document.getElementById('toolbar');
    const toolbarShell = document.getElementById('toolbarShell');
    const toolsToggle = document.getElementById('tools-toggle');
    const toolsCategoryPanel = document.getElementById('toolsCategoryPanel');
    const panelButtons = toolbar.querySelectorAll('.toolbar-button[data-panel]');
    const panels = document.querySelectorAll('.panel');
    const recentChip = document.getElementById('recent-chip');
    const mainCanvas = document.querySelector('main');

    function closePanels() {
      panels.forEach((panel) => panel.classList.remove('visible'));
      panelButtons.forEach((btn) => btn.classList.remove('active'));
      toolsCategoryPanel.classList.remove('visible');
      toolsToggle.classList.remove('active');
    }

    // Tools toggle (shows category panel outside toolbar)
    toolsToggle.addEventListener('click', () => {
      const shouldOpen = !toolsCategoryPanel.classList.contains('visible');

      closePanels();

      if (shouldOpen) {
        toolsCategoryPanel.classList.add('visible');
        toolsToggle.classList.add('active');

        // Position panel below the toolbar
        const toolbarRect = toolbar.getBoundingClientRect();
        toolsCategoryPanel.style.left = `${toolbarRect.left}px`;
        toolsCategoryPanel.style.top = `${toolbarRect.bottom + 12}px`;
      }
    });

    // Tool category buttons (Layer, Format, etc.)
    const toolCategoryButtons = document.querySelectorAll('.tool-category-button[data-tool]');
    toolCategoryButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const toolId = `panel-${btn.dataset.tool}`;
        const targetPanel = document.getElementById(toolId);

        if (targetPanel) {
          // Close category panel and show specific tool panel
          toolsCategoryPanel.classList.remove('visible');
          targetPanel.classList.add('visible');

          // Position tool panel where category panel was
          const categoryRect = toolsCategoryPanel.getBoundingClientRect();
          targetPanel.style.left = `${categoryRect.left}px`;
          targetPanel.style.top = `${categoryRect.top}px`;
        }
      });
    });

    // Other panel buttons (Recents, Org)
    panelButtons.forEach((btn) => {
      btn.addEventListener('click', (e) => {
        const panelId = `panel-${btn.dataset.panel}`;
        const targetPanel = document.getElementById(panelId);
        const shouldOpen = !targetPanel.classList.contains('visible');

        closePanels();

        if (shouldOpen) {
          targetPanel.classList.add('visible');
          btn.classList.add('active');

          // Position panel below the toolbar button
          const btnRect = btn.getBoundingClientRect();
          const toolbarRect = toolbar.getBoundingClientRect();
          targetPanel.style.left = `${toolbarRect.left}px`;
          targetPanel.style.top = `${toolbarRect.bottom + 12}px`;
        }
      });
    });

    panels.forEach((panel) => {
      panel.querySelector('[data-close]').addEventListener('click', () => {
        panel.classList.remove('visible');
        const matchingButton = document.querySelector(
          `.toolbar-button[data-panel="${panel.id.replace('panel-', '')}"]`
        );
        if (matchingButton) matchingButton.classList.remove('active');
      });
    });

    document.addEventListener('click', (event) => {
      if (!event.target.closest('.floating-toolbar') &&
          !event.target.closest('.panel') &&
          !event.target.closest('.tools-category-panel')) {
        closePanels();
        toolbar.classList.remove('visible');
        recentChip.classList.remove('visible');
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        closePanels();
        toolbar.classList.remove('visible');
        recentChip.classList.remove('visible');
      }
    });

    function positionToolbar(x, y) {
      toolbar.classList.add('visible');
      toolbar.style.left = `${x}px`;
      toolbar.style.top = `${y}px`;

      requestAnimationFrame(() => {
        const rect = toolbar.getBoundingClientRect();
        let left = x + 12;
        let top = y + 12;

        if (left + rect.width > window.innerWidth - 16) {
          left = window.innerWidth - rect.width - 16;
        }
        if (top + rect.height > window.innerHeight - 16) {
          top = window.innerHeight - rect.height - 16;
        }
        if (left < 16) left = 16;
        if (top < 16) top = 16;

        toolbar.style.left = `${left}px`;
        toolbar.style.top = `${top}px`;

        // Position recent chip to the right of toolbar
        recentChip.style.left = `${left + rect.width + 16}px`;
        recentChip.style.top = `${top + 12}px`;
        recentChip.classList.add('visible');
      });
    }

    mainCanvas.addEventListener('contextmenu', (event) => {
      event.preventDefault();
      closePanels();
      positionToolbar(event.clientX, event.clientY);
    });

    const fakeRecentNotes = [
      'Design Sync',
      'Research Synthesis',
      'Customer Feedback',
      'Experiment Ideas',
    ];
    let recentIndex = 0;
    setInterval(() => {
      recentIndex = (recentIndex + 1) % fakeRecentNotes.length;
      recentChip.textContent = `Last: ${fakeRecentNotes[recentIndex]}`;
    }, 5000);
  </script>
</body>
</html>
