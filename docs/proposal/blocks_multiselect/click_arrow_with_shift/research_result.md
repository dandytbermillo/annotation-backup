Validate Click Propagation and Modifier Behavior in Plain Mode Block Selection
Plain Mode Collapsible Block Event Handling (Modifier Keys & Arrow Clicks)
Modifier Key Clicks on Header/Title
Shift or Cmd/Ctrl + Click: When clicking a collapsible block’s header (or title text) with Shift or Command/Ctrl held, the NodeView’s event handlers intercept the event in the capture phase. In the handleHeaderMouseDownCapture handler, the editor checks for Shift/Cmd and, if a collapsible block is found at the click position, it executes the block selection logic (selecting or extending the selection) and then calls event.preventDefault() and event.stopPropagation(). This means the NodeView suppresses propagation for Shift/Cmd clicks, handling the selection internally. As a result, the click does not reach the CollapsibleBlockSelection plugin’s mousedown handler in these cases (the NodeView has already handled the multi-select or range-select action and stopped the event). The NodeView’s onClick capture also ignores modifier-key clicks entirely (it returns early without calling preventDefault), ensuring no default title-edit behavior occurs with modifiers.
Alt/Option + Click: If Alt/Option is held while clicking the header or title, the NodeView does not stop the event. In handleHeaderMouseDownCapture, an Alt key causes an immediate return with no preventDefault or stopPropagation. Likewise, the title’s onClick handler simply returns if any modifier is pressed, allowing the event to bubble. Because the NodeView doesn’t consume Alt-click events, the click will propagate out to the editor’s plugin. In this scenario the CollapsibleBlockSelection plugin does receive the event in its handleDOMEvents.mousedown hook. Since Alt is not treated as a special modifier in the plugin’s logic (isModKey only covers Cmd/Ctrl), the plugin will handle it as a regular click on the header: it calls event.preventDefault()/stopPropagation() and sets a text selection at the click position, then selects that collapsible block. In short, an Alt+click on the header/title bypasses NodeView suppression and is handled by the selection plugin as a normal block selection (no collapse toggle occurs on an Alt-click).
Arrow Icon Click Behavior
Plain left-click (no modifiers): A normal click on the collapsible arrow icon will toggle the block’s collapsed state. The NodeView’s handleArrowClick handler runs on a left-click, and if no modifier keys are pressed it calls toggleCollapse() to expand/collapse the block. It also calls event.preventDefault() and event.stopPropagation() in this case. This means a plain arrow click will change the collapse state and the event will not propagate beyond the NodeView (preventing the selection plugin or any other handler from seeing this click).
Modified click (Shift/Cmd/Ctrl/Alt + click on arrow): If a modifier key is held, the arrow’s onClick handler immediately returns without doing anything. No collapse toggle is performed when Shift, Ctrl (Cmd on Mac), or Alt is pressed. Notably, in those cases the arrow handler also does not call preventDefault or stopPropagation (it simply exits). The NodeView’s header-level capture logic is also designed to treat the arrow element as an interactive target and skip its normal handling for it. The net effect is that a Shift/Cmd/Alt click on the arrow is allowed to propagate up to the editor’s plugin. The CollapsibleBlockSelection plugin will then handle the event just as if the header was clicked with a modifier:
Shift + arrow click: The plugin intercepts the mousedown and sets a collapsible range selection (extending the selection from a previously selected block to this block). The event is stopped in the plugin, so no browser text selection occurs.
Cmd/Ctrl + arrow click: The plugin’s handler will toggle the selection state of that block (adding or removing the clicked block from the multi-selection set), again calling preventDefault/stopPropagation in the process. This allows multi-select of collapsible blocks without toggling collapse.
Alt/Option + arrow click: Because the NodeView ignored the event, the plugin treats this like a regular click on the block’s header. It will perform a single-block selection (focusing that collapsible block) by setting a text selection and then converting it to a block selection. No collapse toggle happens on an Alt-click; the event is just used for selection.
In summary, plain left-clicks on the arrow collapse/expand the block (with the NodeView consuming the event), whereas modifier-key clicks on the header or arrow do not trigger collapse. Instead, Shift/Cmd clicks are handled for special block selection behavior, and those events are deliberately propagated to (or handled by) the CollapsibleBlockSelection plugin. The current plain-mode implementation confirms that with Shift or Cmd/Ctrl, the NodeView suppresses the event (preventing propagation) and handles multi-selection internally, while with Alt or any modified arrow click, the event is allowed through to the plugin. This ensures that modifier keys are correctly interpreted for selection (and not treated as a collapse toggle), aligning with expected plain mode selection behavior. The arrow icon correctly ignores modifier keys for toggling, and the event propagation in those cases enables the appropriate selection plugin logic to take over, which is the intended behavior for plain mode block selection.